<!-- views/admin/dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Admin Dashboard - The ACJ Portfolio">
    <title>Admin Dashboard - The ACJ Portfolio</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Icons & Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.35.0/dist/apexcharts.min.css">
    
    <!-- Custom CSS -->
    <link href="/assets/admin.css" rel="stylesheet">
    
    <style>
        /* Dashboard Specific Styles */
        .welcome-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 1rem;
            padding: 2rem;
            color: white;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .welcome-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 20s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(30px, -30px) rotate(180deg); }
        }
        
        .quick-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .activity-feed {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .chart-container {
            position: relative;
            height: 350px;
        }
        
        .performance-metric {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        [data-theme="dark"] .performance-metric {
            background: var(--gray-800);
        }
    </style>
</head>
<body>
    <!-- Loading Bar -->
    <div class="loading-bar"></div>
    
    <!-- Main Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light admin-navbar">
        <div class="container-fluid">
            <button class="btn btn-link text-decoration-none p-2" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <a class="navbar-brand" href="/admin/dashboard">
                <i class="fas fa-shield-alt"></i>
                Admin Portal
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <!-- Search -->
                    <li class="nav-item me-3">
                        <div class="search-box" style="width: 300px;">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="form-control" placeholder="Search..." data-search>
                        </div>
                    </li>
                    
                    <!-- Notifications -->
                    <li class="nav-item dropdown me-3">
                        <a class="nav-link position-relative" href="#" id="notificationDropdown" data-bs-toggle="dropdown">
                            <i class="fas fa-bell"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="notificationCount">0</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end" style="width: 350px;">
                            <div class="dropdown-header d-flex justify-content-between align-items-center">
                                <span>Notifications</span>
                                <a href="#" class="text-decoration-none small">Mark all as read</a>
                            </div>
                            <div class="dropdown-divider"></div>
                            <div id="notificationList" style="max-height: 400px; overflow-y: auto;">
                                <!-- Notifications will be loaded here -->
                            </div>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item text-center small" href="/admin/notifications">View all notifications</a>
                        </div>
                    </li>
                    
                    <!-- Quick Actions -->
                    <li class="nav-item dropdown me-3">
                        <a class="nav-link" href="#" data-bs-toggle="dropdown">
                            <i class="fas fa-plus-circle"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                            <h6 class="dropdown-header">Quick Actions</h6>
                            <a class="dropdown-item" href="/admin/blog-posts/new">
                                <i class="fas fa-blog me-2"></i>New Blog Post
                            </a>
                            <a class="dropdown-item" href="/admin/work-items/new">
                                <i class="fas fa-briefcase me-2"></i>New Work Item
                            </a>
                            <a class="dropdown-item" href="/admin/categories/new">
                                <i class="fas fa-tag me-2"></i>New Category
                            </a>
                        </div>
                    </li>
                    
                    <!-- Theme Toggle -->
                    <li class="nav-item me-3">
                        <button class="btn btn-link nav-link" id="themeToggle">
                            <i class="fas fa-moon"></i>
                        </button>
                    </li>
                    
                    <!-- User Menu -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" data-bs-toggle="dropdown">
                            <img src="/assets/img/default-avatar.png" alt="Avatar" class="rounded-circle me-2" width="32" height="32" data-user-avatar>
                            <span data-user-name>Admin</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                            <div class="dropdown-item-text">
                                <div class="d-flex align-items-center">
                                    <img src="/assets/img/default-avatar.png" alt="Avatar" class="rounded-circle me-3" width="48" height="48" data-user-avatar>
                                    <div>
                                        <div class="fw-bold" data-user-name>Admin</div>
                                        <div class="small text-muted" data-user-email>admin@example.com</div>
                                        <div class="small text-muted" data-user-role>Administrator</div>
                                    </div>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#profileModal">
                                <i class="fas fa-user me-2"></i>Profile
                            </a>
                            <a class="dropdown-item" href="/admin/settings">
                                <i class="fas fa-cog me-2"></i>Settings
                            </a>
                            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
                                <i class="fas fa-key me-2"></i>Change Password
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#" id="logoutBtn">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <div class="d-flex">
        <!-- Sidebar -->
        <nav class="admin-sidebar">
            <div class="p-3">
                <h6 class="text-muted text-uppercase small fw-bold mb-3">Main Navigation</h6>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="/admin/dashboard">
                            <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/blog-posts">
                            <i class="fas fa-blog me-2"></i>Blog Posts
                            <span class="badge bg-primary float-end" id="sidebar-blog-count">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/work-items">
                            <i class="fas fa-briefcase me-2"></i>Work Items
                            <span class="badge bg-success float-end" id="sidebar-work-count">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/contacts">
                            <i class="fas fa-envelope me-2"></i>Contacts
                            <span class="badge bg-warning float-end" id="sidebar-contacts-count">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/categories">
                            <i class="fas fa-tags me-2"></i>Categories
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/content">
                            <i class="fas fa-edit me-2"></i>Content
                        </a>
                    </li>
                </ul>
                
                <h6 class="text-muted text-uppercase small fw-bold mb-3 mt-4">Analytics</h6>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/analytics">
                            <i class="fas fa-chart-line me-2"></i>Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/reports">
                            <i class="fas fa-file-alt me-2"></i>Reports
                        </a>
                    </li>
                </ul>
                
                <h6 class="text-muted text-uppercase small fw-bold mb-3 mt-4">System</h6>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/users" data-role="super_admin">
                            <i class="fas fa-users me-2"></i>Users
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/settings">
                            <i class="fas fa-cog me-2"></i>Settings
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/backup">
                            <i class="fas fa-database me-2"></i>Backup
                        </a>
                    </li>
                </ul>
            </div>
            
            <!-- Sidebar Footer -->
            <div class="position-absolute bottom-0 w-100 p-3 border-top">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <div class="small text-muted">Server Status</div>
                        <div class="small">
                            <i class="fas fa-circle text-success me-1"></i>Online
                        </div>
                    </div>
                    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#helpModal">
                        <i class="fas fa-question-circle"></i>
                    </button>
                </div>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="admin-content">
            <!-- Welcome Banner -->
            <div class="welcome-banner">
                <div class="position-relative">
                    <h1 class="h3 mb-3">
                        Welcome back, <span data-user-name>Admin</span>! ðŸ‘‹
                    </h1>
                    <p class="mb-4">Here's what's happening with your portfolio today.</p>
                    <div class="row g-4">
                        <div class="col-auto">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-clock me-2"></i>
                                <span id="currentDateTime">Loading...</span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-user-clock me-2"></i>
                                <span>Last login: <span id="lastLogin">Loading...</span></span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-shield-alt me-2"></i>
                                <span>Security: <strong>Good</strong></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="quick-stats-grid">
                <div class="stat-card" data-context-menu="card">
                    <div class="stat-icon bg-primary bg-gradient">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value" data-stat="total-users">0</div>
                    <div class="stat-label">Total Users</div>
                    <div class="stat-change" id="users-change">
                        <i class="fas fa-arrow-up"></i>
                        <span>Loading...</span>
                    </div>
                </div>

                <div class="stat-card success" data-context-menu="card">
                    <div class="stat-icon bg-success bg-gradient">
                        <i class="fas fa-blog"></i>
                    </div>
                    <div class="stat-value" data-stat="total-posts">0</div>
                    <div class="stat-label">Blog Posts</div>
                    <div class="stat-change" id="posts-change">
                        <i class="fas fa-arrow-up"></i>
                        <span>Loading...</span>
                    </div>
                </div>

                <div class="stat-card info" data-context-menu="card">
                    <div class="stat-icon bg-info bg-gradient">
                        <i class="fas fa-briefcase"></i>
                    </div>
                    <div class="stat-value" data-stat="total-work">0</div>
                    <div class="stat-label">Work Items</div>
                    <div class="stat-change" id="work-change">
                        <i class="fas fa-arrow-up"></i>
                        <span>Loading...</span>
                    </div>
                </div>

                <div class="stat-card warning" data-context-menu="card">
                    <div class="stat-icon bg-warning bg-gradient">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div class="stat-value" data-stat="unread-contacts">0</div>
                    <div class="stat-label">Unread Contacts</div>
                    <div class="stat-change" id="contacts-change">
                        <i class="fas fa-arrow-up"></i>
                        <span>Loading...</span>
                    </div>
                </div>
            </div>
            
            <!-- Charts Row -->
            <div class="row mb-4">
                <div class="col-lg-8">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-chart-line me-2"></i>Traffic Overview
                                </h5>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" class="btn btn-outline-primary active" data-period="week">Week</button>
                                    <button type="button" class="btn btn-outline-primary" data-period="month">Month</button>
                                    <button type="button" class="btn btn-outline-primary" data-period="year">Year</button>
                                </div>
                            </div>
                        </div>
                        <div class="dashboard-card-body">
                            <div id="trafficChart" class="chart-container"></div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-chart-pie me-2"></i>Content Distribution
                            </h5>
                        </div>
                        <div class="dashboard-card-body">
                            <div id="contentChart" class="chart-container"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Activity and Tasks Row -->
            <div class="row mb-4">
                <div class="col-lg-8">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-history me-2"></i>Recent Activity
                                </h5>
                                <a href="/admin/activity" class="btn btn-sm btn-outline-primary">View All</a>
                            </div>
                        </div>
                        <div class="dashboard-card-body">
                            <div class="timeline activity-feed" id="activityFeed">
                                <!-- Activity items will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-tasks me-2"></i>Quick Tasks
                                </h5>
                                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#newTaskModal">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="dashboard-card-body">
                            <div id="tasksList">
                                <div class="text-center text-muted">
                                    <i class="fas fa-tasks fa-2x mb-3"></i>
                                    <p>No pending tasks</p>
                                    <small>Click "Add Task" to create your first task</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Performance Metrics -->
            <div class="row mb-4">
                <div class="col-lg-6">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-tachometer-alt me-2"></i>System Performance
                            </h5>
                        </div>
                        <div class="dashboard-card-body">
                            <div class="performance-metric">
                                <div>
                                    <div class="fw-bold">CPU Usage</div>
                                    <div class="small text-muted">Server processor load</div>
                                </div>
                                <div class="text-end">
                                    <div class="h4 mb-0">23%</div>
                                    <div class="progress" style="width: 100px; height: 4px;">
                                        <div class="progress-bar bg-success" style="width: 23%"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="performance-metric">
                                <div>
                                    <div class="fw-bold">Memory Usage</div>
                                    <div class="small text-muted">RAM consumption</div>
                                </div>
                                <div class="text-end">
                                    <div class="h4 mb-0">47%</div>
                                    <div class="progress" style="width: 100px; height: 4px;">
                                        <div class="progress-bar bg-warning" style="width: 47%"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="performance-metric">
                                <div>
                                    <div class="fw-bold">Disk Usage</div>
                                    <div class="small text-muted">Storage space</div>
                                </div>
                                <div class="text-end">
                                    <div class="h4 mb-0">68%</div>
                                    <div class="progress" style="width: 100px; height: 4px;">
                                        <div class="progress-bar bg-danger" style="width: 68%"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="performance-metric">
                                <div>
                                    <div class="fw-bold">Network I/O</div>
                                    <div class="small text-muted">Bandwidth usage</div>
                                </div>
                                <div class="text-end">
                                    <div class="h4 mb-0">12 MB/s</div>
                                    <div class="progress" style="width: 100px; height: 4px;">
                                        <div class="progress-bar bg-info" style="width: 35%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-globe me-2"></i>Top Referrers
                            </h5>
                        </div>
                        <div class="dashboard-card-body">
                            <div class="data-table">
                                <table class="table table-hover" id="topReferrersTable">
                                    <thead>
                                        <tr>
                                            <th>Source</th>
                                            <th>Visitors</th>
                                            <th>Bounce Rate</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Referrer data will be loaded dynamically -->
                                        <tr>
                                            <td colspan="3" class="text-center text-muted">
                                                <i class="fas fa-spinner fa-spin me-2"></i>Loading referrer data...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions Grid -->
            <div class="dashboard-card mb-4">
                <div class="dashboard-card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-bolt me-2"></i>Quick Actions
                    </h5>
                </div>
                <div class="dashboard-card-body">
                    <div class="row g-3">
                        <div class="col-md-3 col-sm-6">
                            <a href="/admin/blog-posts/new" class="btn btn-outline-primary w-100 p-3">
                                <i class="fas fa-plus-circle fa-2x mb-2"></i>
                                <div>New Blog Post</div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <a href="/admin/work-items/new" class="btn btn-outline-success w-100 p-3">
                                <i class="fas fa-briefcase fa-2x mb-2"></i>
                                <div>Add Work Item</div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <a href="/admin/contacts" class="btn btn-outline-warning w-100 p-3">
                                <i class="fas fa-envelope fa-2x mb-2"></i>
                                <div>View Messages</div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <a href="/admin/analytics" class="btn btn-outline-info w-100 p-3">
                                <i class="fas fa-chart-bar fa-2x mb-2"></i>
                                <div>View Analytics</div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Profile Modal -->
    <div class="modal fade modal-modern" id="profileModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-user me-2"></i>My Profile
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="profileForm" data-ajax data-endpoint="/auth/profile" data-method="PUT">
                        <div class="row">
                            <div class="col-md-4 text-center">
                                <img src="/assets/img/default-avatar.png" alt="Avatar" class="rounded-circle mb-3" width="150" height="150" data-user-avatar>
                                <div class="mb-3">
                                    <label class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-camera me-2"></i>Change Photo
                                        <input type="file" hidden accept="image/*" id="avatarInput">
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label class="form-label">Username</label>
                                    <input type="text" class="form-control" id="profileUsername" readonly>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Full Name</label>
                                    <input type="text" class="form-control" id="profileFullName" name="fullName">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="profileEmail" name="email">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Phone</label>
                                    <input type="tel" class="form-control" id="profilePhone" name="phone">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Bio</label>
                                    <textarea class="form-control" id="profileBio" name="bio" rows="3"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Role</label>
                                    <input type="text" class="form-control" id="profileRole" readonly>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" form="profileForm" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Change Password Modal -->
    <div class="modal fade modal-modern" id="changePasswordModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-key me-2"></i>Change Password
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm" data-ajax data-endpoint="/auth/change-password" data-method="POST">
                        <div class="mb-3">
                            <label class="form-label">Current Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="currentPassword" name="currentPassword" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('currentPassword')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">New Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="newPassword" name="newPassword" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('newPassword')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text">Password must be at least 8 characters long.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Confirm New Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="confirmNewPassword" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirmNewPassword')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Make sure your password is strong and unique.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" form="changePasswordForm" class="btn btn-primary">
                        <i class="fas fa-lock me-2"></i>Update Password
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- New Task Modal -->
    <div class="modal fade modal-modern" id="newTaskModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus-circle me-2"></i>New Task
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="newTaskForm">
                        <div class="mb-3">
                            <label class="form-label">Task Title</label>
                            <input type="text" class="form-control" id="taskTitle" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="taskDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Priority</label>
                            <select class="form-select" id="taskPriority">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Due Date</label>
                            <input type="datetime-local" class="form-control" id="taskDueDate">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addNewTask()">
                        <i class="fas fa-plus me-2"></i>Add Task
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Help Modal -->
    <div class="modal fade modal-modern" id="helpModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-question-circle me-2"></i>Help & Documentation
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="accordion" id="helpAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#help1">
                                    Getting Started
                                </button>
                            </h2>
                            <div id="help1" class="accordion-collapse collapse show" data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    Welcome to the Admin Dashboard! Here you can manage all aspects of your portfolio website.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help2">
                                    Keyboard Shortcuts
                                </button>
                            </h2>
                            <div id="help2" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    <table class="table">
                                        <tr><td><kbd>Ctrl + S</kbd></td><td>Save current form</td></tr>
                                        <tr><td><kbd>Ctrl + N</kbd></td><td>Create new item</td></tr>
                                        <tr><td><kbd>Ctrl + K</kbd></td><td>Open command palette</td></tr>
                                        <tr><td><kbd>Alt + T</kbd></td><td>Toggle theme</td></tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Context Menu -->
    <div class="context-menu"></div>
    
    <!-- Toast Container -->
    <div class="toast-container"></div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.35.0/dist/apexcharts.min.js"></script>
    <script src="/assets/admin.js"></script>
    
    <script>
        // Dashboard specific functionality
        class DashboardManager {
            constructor() {
                this.charts = {};
                this.init();
            }
            
            async init() {
                await this.loadDashboardData();
                await this.loadAnalyticsData();
                this.initializeCharts();
                this.setupRealtimeUpdates();
                this.updateDateTime();
                this.loadNotifications();
                this.loadActivityFeed();
                this.loadSystemPerformance();
                this.loadReferrerAnalytics();
                this.setupPeriodButtons();
            }
            
            async loadDashboardData() {
                try {
                    const response = await adminSystem.apiRequest('/dashboard/stats');
                    if (response.success) {
                        this.updateStats(response.data);
                    }
                } catch (error) {
                    console.error('Failed to load dashboard data:', error);
                }
            }
            
            updateStats(data) {
                // Update stat cards
                document.querySelector('[data-stat="total-users"]').textContent = data.total.users || 0;
                document.querySelector('[data-stat="total-posts"]').textContent = data.total.blogPosts || 0;
                document.querySelector('[data-stat="total-work"]').textContent = data.total.workItems || 0;
                document.querySelector('[data-stat="unread-contacts"]').textContent = data.active.unreadContacts || 0;

                // Update sidebar counts
                document.getElementById('sidebar-blog-count').textContent = data.total.blogPosts || 0;
                document.getElementById('sidebar-work-count').textContent = data.total.workItems || 0;
                document.getElementById('sidebar-contacts-count').textContent = data.active.unreadContacts || 0;

                // Update stat changes
                this.updateStatChanges(data.changes);

                // Update notification count
                document.getElementById('notificationCount').textContent = data.notifications || 0;

                // Update last login
                if (data.lastLogin) {
                    document.getElementById('lastLogin').textContent = adminSystem.formatDate(data.lastLogin);
                }
            }

            updateStatChanges(changes) {
                const updateChangeElement = (elementId, changeValue, label) => {
                    const element = document.getElementById(elementId);
                    if (!element) return;

                    const isPositive = changeValue >= 0;
                    const absChange = Math.abs(changeValue);

                    element.className = `stat-change ${isPositive ? 'positive' : 'negative'}`;
                    element.innerHTML = `
                        <i class="fas fa-arrow-${isPositive ? 'up' : 'down'}"></i>
                        <span>${absChange}% ${label}</span>
                    `;
                };

                updateChangeElement('users-change', changes?.users || 0, 'from last month');
                updateChangeElement('posts-change', changes?.posts || 0, 'from last month');
                updateChangeElement('work-change', changes?.work || 0, 'from last month');
                updateChangeElement('contacts-change', changes?.contacts || 0, 'from last month');
            }
            
            initializeCharts() {
                // Traffic Chart
                const trafficOptions = {
                    series: [{
                        name: 'Page Views',
                        data: this.trafficData?.datasets?.pageViews || [31, 40, 28, 51, 42, 82, 56]
                    }, {
                        name: 'Unique Visitors',
                        data: this.trafficData?.datasets?.uniqueVisitors || [11, 32, 45, 32, 34, 52, 41]
                    }],
                    chart: {
                        height: 350,
                        type: 'area',
                        toolbar: {
                            show: false
                        }
                    },
                    dataLabels: {
                        enabled: false
                    },
                    stroke: {
                        curve: 'smooth',
                        width: 2
                    },
                    fill: {
                        type: 'gradient',
                        gradient: {
                            opacityFrom: 0.6,
                            opacityTo: 0.1
                        }
                    },
                    xaxis: {
                        categories: this.trafficData?.labels || ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                    },
                    colors: ['#6366f1', '#22d3ee']
                };

                this.charts.traffic = new ApexCharts(document.querySelector("#trafficChart"), trafficOptions);
                this.charts.traffic.render();

                // Content Distribution Chart
                const contentSeries = this.contentData?.distribution?.map(item => item.value) || [44, 55, 13, 43];
                const contentLabels = this.contentData?.distribution?.map(item => item.name) || ['Blog Posts', 'Work Items', 'Categories', 'Contacts'];

                const contentOptions = {
                    series: contentSeries,
                    chart: {
                        height: 350,
                        type: 'donut'
                    },
                    labels: contentLabels,
                    colors: ['#6366f1', '#10b981', '#f59e0b', '#ef4444'],
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        y: {
                            formatter: function(value) {
                                return value + ' items';
                            }
                        }
                    }
                };

                this.charts.content = new ApexCharts(document.querySelector("#contentChart"), contentOptions);
                this.charts.content.render();
            }
            
            setupRealtimeUpdates() {
                // Update every 30 seconds
                setInterval(() => {
                    this.loadDashboardData();
                    this.loadSystemPerformance();
                    this.loadReferrerAnalytics();
                    // Don't reload analytics data to preserve period selection
                }, 30000);
            }
            
            updateDateTime() {
                const updateTime = () => {
                    const now = new Date();
                    const options = {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    };
                    document.getElementById('currentDateTime').textContent = now.toLocaleDateString('en-US', options);
                };
                
                updateTime();
                setInterval(updateTime, 60000); // Update every minute
            }
            
            async loadNotifications() {
                try {
                    const response = await adminSystem.apiRequest('/notifications?limit=5');
                    if (response.success) {
                        this.displayNotifications(response.data);
                    }
                } catch (error) {
                    console.error('Failed to load notifications:', error);
                }
            }
            
            displayNotifications(notifications) {
                const container = document.getElementById('notificationList');
                
                if (notifications.length === 0) {
                    container.innerHTML = '<div class="p-3 text-center text-muted">No new notifications</div>';
                    return;
                }
                
                container.innerHTML = notifications.map(notif => `
                    <a href="#" class="dropdown-item ${!notif.read ? 'bg-light' : ''}">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-${this.getNotificationIcon(notif.type)} text-${this.getNotificationColor(notif.type)}"></i>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <p class="mb-1">${notif.message}</p>
                                <small class="text-muted">${this.formatTimeAgo(notif.createdAt)}</small>
                            </div>
                        </div>
                    </a>
                `).join('');
            }
            
            async loadActivityFeed() {
                try {
                    const response = await adminSystem.apiRequest('/activity?limit=10');
                    if (response.success) {
                        this.displayActivity(response.data);
                    }
                } catch (error) {
                    console.error('Failed to load activity:', error);
                }
            }

            async loadAnalyticsData(period = 'week') {
                try {
                    const [trafficResponse, contentResponse] = await Promise.all([
                        adminSystem.apiRequest(`/dashboard/analytics/traffic?period=${period}`),
                        adminSystem.apiRequest('/dashboard/analytics/content-distribution')
                    ]);

                    if (trafficResponse.success) {
                        this.trafficData = trafficResponse.data;
                    }

                    if (contentResponse.success) {
                        this.contentData = contentResponse.data;
                    }
                } catch (error) {
                    console.error('Failed to load analytics data:', error);
                }
            }

            setupPeriodButtons() {
                const periodButtons = document.querySelectorAll('[data-period]');
                periodButtons.forEach(button => {
                    button.addEventListener('click', async (e) => {
                        // Update active state
                        periodButtons.forEach(btn => btn.classList.remove('active'));
                        e.target.classList.add('active');

                        // Load data for selected period
                        const period = e.target.getAttribute('data-period');
                        await this.loadAnalyticsData(period);

                        // Update chart
                        if (this.charts.traffic && this.trafficData) {
                            this.charts.traffic.updateOptions({
                                series: [{
                                    name: 'Page Views',
                                    data: this.trafficData.datasets.pageViews
                                }, {
                                    name: 'Unique Visitors',
                                    data: this.trafficData.datasets.uniqueVisitors
                                }],
                                xaxis: {
                                    categories: this.trafficData.labels
                                }
                            });
                        }
                    });
                });
            }

            async loadSystemPerformance() {
                try {
                    const response = await adminSystem.apiRequest('/dashboard/system/performance');
                    if (response.success) {
                        this.updateSystemPerformance(response.data);
                    }
                } catch (error) {
                    console.error('Failed to load system performance:', error);
                }
            }

            async loadReferrerAnalytics() {
                try {
                    const response = await adminSystem.apiRequest('/dashboard/analytics/referrers');
                    if (response.success) {
                        this.updateReferrerAnalytics(response.data.referrers);
                    }
                } catch (error) {
                    console.error('Failed to load referrer analytics:', error);
                }
            }
            
            displayActivity(activities) {
                const container = document.getElementById('activityFeed');

                if (activities.length === 0) {
                    container.innerHTML = '<div class="text-center text-muted">No recent activity</div>';
                    return;
                }

                container.innerHTML = activities.map(activity => `
                    <div class="timeline-item">
                        <div class="timeline-content">
                            <div class="timeline-time">${this.formatTimeAgo(activity.createdAt)}</div>
                            <div class="timeline-title">${activity.title}</div>
                            <div class="timeline-description">${activity.description}</div>
                        </div>
                    </div>
                `).join('');
            }

            updateSystemPerformance(data) {
                // Update CPU usage
                const cpuElement = document.querySelector('.performance-metric:nth-child(1) .h4');
                const cpuProgress = document.querySelector('.performance-metric:nth-child(1) .progress-bar');
                if (cpuElement && cpuProgress) {
                    cpuElement.textContent = data.cpu.usage + '%';
                    cpuProgress.style.width = data.cpu.usage + '%';
                    cpuProgress.className = `progress-bar ${data.cpu.usage > 80 ? 'bg-danger' : data.cpu.usage > 60 ? 'bg-warning' : 'bg-success'}`;
                }

                // Update Memory usage
                const memoryElement = document.querySelector('.performance-metric:nth-child(2) .h4');
                const memoryProgress = document.querySelector('.performance-metric:nth-child(2) .progress-bar');
                if (memoryElement && memoryProgress) {
                    memoryElement.textContent = data.memory.used + '%';
                    memoryProgress.style.width = data.memory.used + '%';
                    memoryProgress.className = `progress-bar ${data.memory.used > 80 ? 'bg-danger' : data.memory.used > 60 ? 'bg-warning' : 'bg-info'}`;
                }

                // Update Disk usage
                const diskElement = document.querySelector('.performance-metric:nth-child(3) .h4');
                const diskProgress = document.querySelector('.performance-metric:nth-child(3) .progress-bar');
                if (diskElement && diskProgress) {
                    diskElement.textContent = data.disk.used + '%';
                    diskProgress.style.width = data.disk.used + '%';
                    diskProgress.className = `progress-bar ${data.disk.used > 80 ? 'bg-danger' : data.disk.used > 60 ? 'bg-warning' : 'bg-success'}`;
                }

                // Update Network I/O
                const networkElement = document.querySelector('.performance-metric:nth-child(4) .h4');
                if (networkElement) {
                    networkElement.textContent = data.network.upload + ' MB/s';
                }
            }

            updateReferrerAnalytics(referrers) {
                const tbody = document.querySelector('#topReferrersTable tbody');
                if (!tbody) return;

                tbody.innerHTML = referrers.map(referrer => `
                    <tr>
                        <td>
                            <i class="${referrer.icon} me-2"></i>${referrer.source}
                        </td>
                        <td>${referrer.visitors.toLocaleString()}</td>
                        <td>
                            <span class="badge bg-${referrer.bounceRate > 50 ? 'danger' : referrer.bounceRate > 30 ? 'warning' : 'success'}">
                                ${referrer.bounceRate}%
                            </span>
                        </td>
                    </tr>
                `).join('');
            }
            
            getNotificationIcon(type) {
                const icons = {
                    'info': 'info-circle',
                    'success': 'check-circle',
                    'warning': 'exclamation-triangle',
                    'error': 'exclamation-circle',
                    'message': 'envelope',
                    'user': 'user'
                };
                return icons[type] || 'bell';
            }
            
            getNotificationColor(type) {
                const colors = {
                    'info': 'info',
                    'success': 'success',
                    'warning': 'warning',
                    'error': 'danger',
                    'message': 'primary',
                    'user': 'secondary'
                };
                return colors[type] || 'primary';
            }
            
            formatTimeAgo(date) {
                const seconds = Math.floor((new Date() - new Date(date)) / 1000);
                
                let interval = Math.floor(seconds / 31536000);
                if (interval > 1) return interval + " years ago";
                
                interval = Math.floor(seconds / 2592000);
                if (interval > 1) return interval + " months ago";
                
                interval = Math.floor(seconds / 86400);
                if (interval > 1) return interval + " days ago";
                
                interval = Math.floor(seconds / 3600);
                if (interval > 1) return interval + " hours ago";
                
                interval = Math.floor(seconds / 60);
                if (interval > 1) return interval + " minutes ago";
                
                return "Just now";
            }
        }
        
        // Initialize Dashboard Manager
        document.addEventListener('DOMContentLoaded', () => {
            window.dashboardManager = new DashboardManager();
        });
        
        // Helper functions
        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            const button = field.nextElementSibling;
            const icon = button.querySelector('i');
            
            if (field.type === 'password') {
                field.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                field.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        function addNewTask() {
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDescription').value;
            const priority = document.getElementById('taskPriority').value;
            const dueDate = document.getElementById('taskDueDate').value;
            
            // Add task logic here
            adminSystem.showToast('Task added successfully', 'success');
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('newTaskModal')).hide();
            
            // Reset form
            document.getElementById('newTaskForm').reset();
        }
    </script>
</body>
</html>